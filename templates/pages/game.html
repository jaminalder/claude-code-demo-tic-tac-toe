{{define "game.html"}}{{template "base.html" .}}{{end}}

{{define "content"}}
<div class="hero">
    <h2>Game #{{.GameID}}</h2>
    
    {{if .PlayerEmojis}}
    <div class="players-display">
        <p><strong>Players:</strong> 
        {{range $i, $emoji := .PlayerEmojis}}{{if $i}} vs {{end}}{{$emoji}}{{end}}
        </p>
    </div>
    {{end}}
    
    <!-- Turn Indicator -->
    <div id="game-status">
        {{if .IsGameActive}}
        <div class="turn-indicator">
            {{if .CurrentTurnEmoji}}
                {{if .IsPlayersTurn}}
                    <span>üéØ Your turn! ({{.CurrentTurnEmoji}})</span>
                {{else}}
                    <span>{{.CurrentTurnEmoji}}'s turn</span>
                {{end}}
            {{end}}
        </div>
        {{end}}
        
        <!-- Game Result -->
        {{if .IsGameFinished}}
            {{if .WinnerEmoji}}
            <div class="game-result winner">
                üèÜ {{.WinnerEmoji}} wins!
            </div>
            {{else if eq .GameStatus "draw"}}
            <div class="game-result draw">
                ü§ù It's a draw!
            </div>
            {{end}}
        {{end}}
    </div>
    
    {{if .IsGameActive}}
    <p>Click on any empty cell to place your emoji!</p>
    {{else if .IsGameFinished}}
    <p>Game finished! Start a new game to play again.</p>
    {{end}}
    
    <div class="game-section">                
        <div id="game-board" class="game-board">
            <div class="game-row">
                <div class="game-cell" hx-post="/api/game/{{.GameID}}/move/0/0" hx-target="#game-board" hx-swap="outerHTML"></div>
                <div class="game-cell" hx-post="/api/game/{{.GameID}}/move/0/1" hx-target="#game-board" hx-swap="outerHTML"></div>
                <div class="game-cell" hx-post="/api/game/{{.GameID}}/move/0/2" hx-target="#game-board" hx-swap="outerHTML"></div>
            </div>
            <div class="game-row">
                <div class="game-cell" hx-post="/api/game/{{.GameID}}/move/1/0" hx-target="#game-board" hx-swap="outerHTML"></div>
                <div class="game-cell" hx-post="/api/game/{{.GameID}}/move/1/1" hx-target="#game-board" hx-swap="outerHTML"></div>
                <div class="game-cell" hx-post="/api/game/{{.GameID}}/move/1/2" hx-target="#game-board" hx-swap="outerHTML"></div>
            </div>
            <div class="game-row">
                <div class="game-cell" hx-post="/api/game/{{.GameID}}/move/2/0" hx-target="#game-board" hx-swap="outerHTML"></div>
                <div class="game-cell" hx-post="/api/game/{{.GameID}}/move/2/1" hx-target="#game-board" hx-swap="outerHTML"></div>
                <div class="game-cell" hx-post="/api/game/{{.GameID}}/move/2/2" hx-target="#game-board" hx-swap="outerHTML"></div>
            </div>
        </div>
        
        <!-- SSE Connection for Real-time Updates -->
        <div hx-ext="sse" sse-connect="/api/game/{{.GameID}}/events" style="display: none;">
            <div sse-swap="move" hx-target="#game-board" hx-swap="outerHTML"></div>
            <div sse-swap="reset" hx-target="#game-board" hx-swap="outerHTML"></div>
            <div sse-swap="initial" hx-target="#game-board" hx-swap="outerHTML"></div>
            <div sse-swap="game_winner" hx-target="#game-board" hx-swap="outerHTML"></div>
            <div sse-swap="game_draw" hx-target="#game-board" hx-swap="outerHTML"></div>
            <div sse-swap="game_status" hx-target="#game-status" hx-swap="outerHTML"></div>
        </div>
        
        <div class="game-controls">
            <button hx-post="/api/game/{{.GameID}}/reset" hx-target="#game-board" hx-swap="outerHTML" class="btn btn-secondary">Reset Game</button>
            <a href="/" class="btn btn-primary">New Game</a>
        </div>
    </div>
</div>
{{end}}

